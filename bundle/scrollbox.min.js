"use strict";var _createClass=function(){function s(t,o){for(var i=0;i<o.length;i++){var s=o[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(t,o,i){return o&&s(t.prototype,o),i&&s(t,i),t}}();function _classCallCheck(t,o){if(!(t instanceof o))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,o){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!o||"object"!=typeof o&&"function"!=typeof o?t:o}function _inherits(t,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+typeof o);t.prototype=Object.create(o&&o.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(t,o):t.__proto__=o)}var PIXI=require("pixi.js"),Viewport=require("pixi-viewport"),Ease=require("pixi-ease"),defaults=require("./defaults"),DEFAULTS=require("./defaults.json"),FADE_SCROLLBAR_TIME=1e3,Scrollbox=function(t){function i(t){_classCallCheck(this,i);var o=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return o.options=defaults(t,DEFAULTS),o.options.divWheel=o.options.divWheel||document.body,o.ease=new Ease.list,o.content=o.addChild(new Viewport({passiveWheel:o.options.stopPropagation,stopPropagation:o.options.stopPropagation,screenWidth:o.options.boxWidth,screenHeight:o.options.boxHeight,divWheel:o.options.divWheel})),o.content.decelerate().on("moved",function(){return o._drawScrollbars()}),o.scrollbar=o.addChild(new PIXI.Graphics),o.scrollbar.interactive=!0,o.scrollbar.on("pointerdown",o.scrollbarDown,o),o.interactive=!0,o.on("pointermove",o.scrollbarMove,o),o.on("pointerup",o.scrollbarUp,o),o.on("pointercancel",o.scrollbarUp,o),o.on("pointerupoutside",o.scrollbarUp,o),o._maskContent=o.addChild(new PIXI.Graphics),o.update(),o}return _inherits(i,PIXI.Container),_createClass(i,[{key:"_drawScrollbars",value:function(){this._isScrollbarHorizontal="scroll"===this.overflowX||-1===["hidden","none"].indexOf(this.overflowX)&&this.scrollWidth>this.options.boxWidth,this._isScrollbarVertical="scroll"===this.overflowY||-1===["hidden","none"].indexOf(this.overflowY)&&this.scrollHeight>this.options.boxHeight,this.scrollbar.clear();var t={left:0};t.right=this.scrollWidth+(this._isScrollbarVertical?this.options.scrollbarSize:0),t.top=0,t.bottom=this.scrollHeight+(this.isScrollbarHorizontal?this.options.scrollbarSize:0);var o=this.scrollWidth+(this.isScrollbarVertical?this.options.scrollbarSize:0),i=this.scrollHeight+(this.isScrollbarHorizontal?this.options.scrollbarSize:0);this.scrollbarTop=this.content.top/i*this.boxHeight,this.scrollbarTop=this.scrollbarTop<0?0:this.scrollbarTop,this.scrollbarHeight=this.boxHeight/i*this.boxHeight,this.scrollbarHeight=this.scrollbarTop+this.scrollbarHeight>this.boxHeight?this.boxHeight-this.scrollbarTop:this.scrollbarHeight,this.scrollbarLeft=this.content.left/o*this.boxWidth,this.scrollbarLeft=this.scrollbarLeft<0?0:this.scrollbarLeft,this.scrollbarWidth=this.boxWidth/o*this.boxWidth,this.scrollbarWidth=this.scrollbarWidth+this.scrollbarLeft>this.boxWidth?this.boxWidth-this.scrollbarLeft:this.scrollbarWidth,this.isScrollbarVertical&&this.scrollbar.beginFill(this.options.scrollbarBackground,this.options.scrollbarBackgroundAlpha).drawRect(this.boxWidth-this.scrollbarSize+this.options.scrollbarOffsetVertical,0,this.scrollbarSize,this.boxHeight).endFill(),this.isScrollbarHorizontal&&this.scrollbar.beginFill(this.options.scrollbarBackground,this.options.scrollbarBackgroundAlpha).drawRect(0,this.boxHeight-this.scrollbarSize+this.options.scrollbarOffsetHorizontal,this.boxWidth,this.scrollbarSize).endFill(),this.isScrollbarVertical&&this.scrollbar.beginFill(this.options.scrollbarForeground,this.options.scrollbarForegroundAlpha).drawRect(this.boxWidth-this.scrollbarSize+this.options.scrollbarOffsetVertical,this.scrollbarTop,this.scrollbarSize,this.scrollbarHeight).endFill(),this.isScrollbarHorizontal&&this.scrollbar.beginFill(this.options.scrollbarForeground,this.options.scrollbarForegroundAlpha).drawRect(this.scrollbarLeft,this.boxHeight-this.scrollbarSize+this.options.scrollbarOffsetHorizontal,this.scrollbarWidth,this.scrollbarSize).endFill(),this.activateFade()}},{key:"_drawMask",value:function(){this._maskContent.beginFill(0).drawRect(0,0,this.boxWidth,this.boxHeight).endFill(),this.content.mask=this._maskContent}},{key:"update",value:function(){if(this.content.mask=null,this._maskContent.clear(),!this._disabled&&(this._drawScrollbars(),this._drawMask(),this.options.dragScroll)){var t=this.isScrollbarHorizontal&&this.isScrollbarVertical?"all":this.isScrollbarHorizontal?"x":"y";null!==t&&this.content.drag({clampWheel:!0,direction:t}).clamp({direction:t,underflow:this.options.underflow})}}},{key:"activateFade",value:function(){var t=this;if(this.options.fade){this.fade&&this.ease.remove(this.fade),this.scrollbar.alpha=1;var o=!0===this.options.fade?FADE_SCROLLBAR_TIME:this.options.fade;this.fade=this.ease.to(this.scrollbar,{alpha:0},o,{wait:this.options.fadeWait,ease:this.options.fadeEase}),this.fade.on("each",function(){return t.content.dirty=!0})}}},{key:"scrollbarDown",value:function(t){var o=this.toLocal(t.data.global);return this.isScrollbarHorizontal&&o.y>this.boxHeight-this.scrollbarSize?(o.x>=this.scrollbarLeft&&o.x<=this.scrollbarLeft+this.scrollbarWidth?this.pointerDown={type:"horizontal",last:o}:(o.x>this.scrollbarLeft?this.content.left+=this.content.worldScreenWidth:this.content.left-=this.content.worldScreenWidth,this.update()),void(this.options.stopPropagation&&t.stopPropagation())):this.isScrollbarVertical&&o.x>this.boxWidth-this.scrollbarSize?(o.y>=this.scrollbarTop&&o.y<=this.scrollbarTop+this.scrollbarWidth?this.pointerDown={type:"vertical",last:o}:(o.y>this.scrollbarTop?this.content.top+=this.content.worldScreenHeight:this.content.top-=this.content.worldScreenHeight,this.update()),void(this.options.stopPropagation&&t.stopPropagation())):void 0}},{key:"scrollbarMove",value:function(t){if(this.pointerDown){if("horizontal"===this.pointerDown.type){var o=this.toLocal(t.data.global);this.content.left+=o.x-this.pointerDown.last.x,this.pointerDown.last=o,this.update()}else if("vertical"===this.pointerDown.type){var i=this.toLocal(t.data.global);this.content.top+=i.y-this.pointerDown.last.y,this.pointerDown.last=i,this.update()}this.options.stopPropagation&&t.stopPropagation()}}},{key:"scrollbarUp",value:function(){this.pointerDown=null}},{key:"resize",value:function(t){this.options.boxWidth=void 0!==t.boxWidth?t.boxWidth:this.options.boxWidth,this.options.boxHeight=void 0!==t.boxHeight?t.boxHeight:this.options.boxHeight,t.scrollWidth&&(this.scrollWidth=t.scrollWidth),t.scrollHeight&&(this.scrollHeight=t.scrollHeight),this.content.resize(this.options.boxWidth,this.options.boxHeight,this.scrollWidth,this.scrollHeight),this.update()}},{key:"ensureVisible",value:function(t,o,i,s){this.content.ensureVisible(t,o,i,s),this._drawScrollbars()}},{key:"scrollbarOffsetHorizontal",get:function(){return this.options.scrollbarOffsetHorizontal},set:function(t){this.options.scrollbarOffsetHorizontal=t}},{key:"scrollbarOffsetVertical",get:function(){return this.options.scrollbarOffsetVertical},set:function(t){this.options.scrollbarOffsetVertical=t}},{key:"disable",get:function(){return this._disabled},set:function(t){this._disabled!==t&&(this._disabled=t,this.update())}},{key:"stopPropagation",get:function(){return this.options.stopPropagation},set:function(t){this.options.stopPropagation=t}},{key:"dragScroll",get:function(){return this.options.dragScroll},set:function(t){(this.options.dragScroll=t)?this.content.drag():this.content.removePlugin("drag"),this.update()}},{key:"boxWidth",get:function(){return this.options.boxWidth},set:function(t){this.options.boxWidth=t,this.content.screenWidth=t,this.update()}},{key:"overflow",get:function(){return this.options.overflow},set:function(t){this.options.overflow=t,this.options.overflowX=t,this.options.overflowY=t,this.update()}},{key:"overflowX",get:function(){return this.options.overflowX},set:function(t){this.options.overflowX=t,this.update()}},{key:"overflowY",get:function(){return this.options.overflowY},set:function(t){this.options.overflowY=t,this.update()}},{key:"boxHeight",get:function(){return this.options.boxHeight},set:function(t){this.options.boxHeight=t,this.content.screenHeight=t,this.update()}},{key:"scrollbarSize",get:function(){return this.options.scrollbarSize},set:function(t){this.options.scrollbarSize=t}},{key:"contentWidth",get:function(){return this.options.boxWidth-(this.isScrollbarVertical?this.options.scrollbarSize:0)}},{key:"contentHeight",get:function(){return this.options.boxHeight-(this.isScrollbarHorizontal?this.options.scrollbarSize:0)}},{key:"isScrollbarVertical",get:function(){return this._isScrollbarVertical}},{key:"isScrollbarHorizontal",get:function(){return this._isScrollbarHorizontal}},{key:"scrollTop",get:function(){return this.content.top}},{key:"scrollLeft",get:function(){return this.content.left}},{key:"scrollWidth",get:function(){return this._scrollWidth||this.content.width},set:function(t){this._scrollWidth=t}},{key:"scrollHeight",get:function(){return this._scrollHeight||this.content.height},set:function(t){this._scrollHeight=t}}]),i}();PIXI&&PIXI.extras&&(PIXI.extras.Scrollbox=Scrollbox),module.exports=Scrollbox;